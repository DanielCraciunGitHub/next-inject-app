import { redirect } from "next/navigation"
import { api } from "@/server/server"
import Link from "fumadocs-core/link"
import { Accordion, Accordions } from "fumadocs-ui/components/accordion"
import { Callout } from "fumadocs-ui/components/callout"
import { Heading } from "fumadocs-ui/components/heading"
import { Step, Steps } from "fumadocs-ui/components/steps"

export { withArticle as default } from "fumadocs-ui/page"

<Steps>

<Step>

## Install the CLI üñ•Ô∏è

```package-install
npm i -g next-inject
```

<Callout title="Info" type="info">
  Restart your terminal after running this command
</Callout>

</Step>
<Step>

## Intialize the base template üì∞

```bash
next-inject init
```

<Accordions>
<Accordion title="What does this command do?">
1. You will receive prompts to choose a project name and your preferred package manager.
2. Install the required dependencies using your package manager.
3. Initialize a new git repository.
4. Create an "init" commit.

</Accordion>
</Accordions>

</Step>
<Step>

## Configure your API Key üîë

<Callout title="Warning" type="warn">
  Leaking this API key may lead to security breaches.

  <ApiKeyCommand />
</Callout>

</Step>

<Step>
## Inject your plugins ‚ö°

<PluginCommands />
</Step>

<Callout title="Info" type="info">
  Injecting these plugins will automatically run `git add .`
</Callout>

<Step>
## Start Building! üõ†Ô∏è

</Step>

</Steps>

export async function ApiKeyCommand() {
  let key
  try {
    key = (await api.pluginRouter.getApiKey()).toString()
  } catch (error) {
    redirect("/login")
  }

return (

<CodeBlock lang="bash" code={`next-inject auth -k ${key}`} />

)
}

export async function PluginCommands() {
  let plugins
  try {
    plugins = await api.pluginRouter.getOwnedPlugins()
  } catch (error) {
    redirect("/login")
  }

return plugins.map(function (plugin) {
return (

<>

<div key={plugin.originalName}>
  <Link href={`/plugins/${plugin.parsedName}`}>
    <Heading as="h3">{plugin.originalName}</Heading>
  </Link>
  <CodeBlock lang="bash" code={`next-inject add ${plugin.parsedName}`} />

  <hr />
</div>

</>
)}) }
